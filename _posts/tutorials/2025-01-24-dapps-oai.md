---
layout: post
title: "Deploying a dApp for Spectrum Sharing on an OpenAirInterface gNB"
date: 2025-01-24
category: tutorials
author: Andrea Lacava
short-description: How to run a Spectrum Sharing dApp leveraging our open source dApp framework and OpenAirInterface
---

{% assign publications = site.data.publications %}

{% assign el = publications.publications | where: "name", "lacava2025dapps" %}
{% assign element = el[0] %}
{% capture pub_lacava2025dapps %}
{% include pub-template.html %}
{% endcapture %}

dApps are real-time O-RAN applications that execute as microservices. They are designed to be co-located with the CU/DU, where user-plane data is readily available.
Currently, the adoption of dApps is under investigation by the O-RAN next Generation Research Group (nGRG) as a way to bring below 10 ms Artificial Intelligence (AI) routines to the RAN.
{: .text-justify}

<img src="/assets/post-assets/dapps.png" class="post-image" alt="dApp Architecture" width="75%">

In this tutorial, we show how setup a 5G networks composed by one gNB and one dApp that performs spectrum sharing.
{: .text-justify}

## gNB Setup

We first start by cloning and setting up the OAI repository with the following commands:

{% highlight bash %}
git clone https://github.com/wineslab/dApp-openairinterface5g openairinterface5g
cd openairinterface5g
{% endhighlight %}

Then, we install and build OAI, including the dApp extension, which is enabled by the flag `--build-e3`:

{% highlight bash %}
source oaienv

cd ./cmake_targets/

# export UHD_VERSION=4.4.0. # if needed to select the version of UHD
./build_oai -I # this must be done only once to install the dependencies of OAI 

./build_oai -w USRP --ninja --gNB --build-e3 --cmake-opt "-DCMAKE_C_FLAGS=-march=native -DCMAKE_CXX_FLAGS=-march=native"
cd ;
{% endhighlight %}

Finally, we can run OAI should always be launched _before_ running the dApp.
Moreover, make sure that `do_SRS` flag is set to 0.
An example of launching OAI can be this one:

{% highlight bash %}
OAI_CONFIG_DIR="../../../targets/PROJECTS/GENERIC-NR-5GC/CONF/"

# x310 configuration 
OAI_CONFIG_FILE="gnb.band78.sa.fr1.106PRB.usrpx300.conf"

# x410 configuration
# OAI_CONFIG_FILE="gnb.band78.sa.fr1.106PRB.usrpx400.conf"

# b210 configuration (not tested in a while, may not work)
# OAI_CONFIG_FILE="gnb.sa.band78.fr1.106PRB.usrpb210.conf"

source oaienv
cd ./cmake_targets/ran_build/build

# x310 and x410
# gdb --args # if needed
taskset -ca 0-45 ./nr-softmodem -O ${OAI_CONFIG_DIR}${OAI_CONFIG_FILE} --gNBs.[0].min_rxtxtime 6 --sa --usrp-tx-thread-config 1  -E --T_stdout 2 --gNBs.[0].do_SRS 0

# b210
# ./nr-softmodem -O ${OAI_CONFIG_DIR}${OAI_CONFIG_FILE} --gNBs.[0].min_rxtxtime 6 --sa --usrp-tx-thread-config 1 -E  --T_stdout  2
{% endhighlight %}

Note that the x310 configuration has been successfully tested Over The Air and on Colosseum (with and without control).

## dApp Setup

To create the dApp, clone its repository with the following commands:

{% highlight bash %}
git clone https://github.com/wineslab/dApp-library dApp
cd dApp
{% endhighlight %}

Finally, to start the dapp the command is the following:

{% highlight bash %}
python3 src/dapp/dapp.py
{% endhighlight %}

There are many possible arguments:
- `ota` bool (false): If true, use the OAI and spectrum configurations for OTA else use the ones of Colosseum
- `control` bool (false): If set to true, performs the PRB blocking
- `energy-gui` bool (false): If set to true, creates and show the energy spectrum
- `iq-plotter-gui` bool (false): If set to true, creates and show the sensed spectrum
- `save-iqs` bool (false): Specify if this is data collection run or not. In the first case I/Q samples will be saved
- `profile`  bool (false): Enable profiling with yappi
- `timed` bool (false): Run with a 5-minute time limit

## Conclusions

If you use the dApp concept and/or the framework to develop your own dApps, please cite the following paper:

> {{ pub_lacava2025dapps | strip_newlines }}
> {: .text-justify}
